name: CI

on:
  pull_request:
    
jobs:
  test:
    runs-on: macOS-latest
    steps:
    - name: Checkout source
      uses: actions/checkout@v2
    
    - name: Build for testing
      run: xcodebuild build-for-testing -sdk iphonesimulator -scheme Wikipedia -derivedDataPath DerivedData

    - name: Run tests
      run: |
        xcrun simctl list --json
        xcodebuild test-without-building -scheme Wikipedia -derivedDataPath DerivedData -destination "platform=iOS Simulator,OS=13.5,name=iPhone 8"

    - name: Upload test output
      if: ${{ success() || failure() }} # always run even if the tests fail
      uses: actions/upload-artifact@v2
      with:
        name: TestResults
        path: DerivedData/Logs/Test/
